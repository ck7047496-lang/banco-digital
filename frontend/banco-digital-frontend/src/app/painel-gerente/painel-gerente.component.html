<div class="painel-gerente-wrapper">
  <aside class="sidebar">
    <div class="sidebar-header">
      <h3>Painel do Gerente</h3>
    </div>
    <nav class="sidebar-nav">
      <ul>
        <li>
          <button [class.active]="viewMode === 'usuarios'" (click)="viewMode = 'usuarios'">
            <img src="assets/icons/users.svg" alt="Usuários" class="menu-icon">
            Gerenciar Usuários
          </button>
        </li>
        <li>
          <button [class.active]="viewMode === 'emprestimos'" (click)="viewMode = 'emprestimos'">
            <img src="assets/icons/money-bag.svg" alt="Empréstimos" class="menu-icon">
            Gerenciar Empréstimos
          </button>
        </li>
        <li>
          <button [class.active]="viewMode === 'dashboard'" (click)="viewMode = 'dashboard'">
            <img src="assets/icons/chart-up.svg" alt="Dashboard" class="menu-icon">
            Dashboard
          </button>
        </li>
        <li>
          <button [class.active]="viewMode === 'configuracoes'" (click)="viewMode = 'configuracoes'">
            <img src="assets/icons/gear.svg" alt="Configurações" class="menu-icon">
            Configurações
          </button>
        </li>
      </ul>
    </nav>
  </aside>

  <div class="content-area">
    <div *ngIf="mensagemSucesso" class="mensagem sucesso">{{ mensagemSucesso }}</div>
    <div *ngIf="mensagemErro" class="mensagem erro">{{ mensagemErro }}</div>

    <!-- Seção de Dashboard -->
    <div *ngIf="viewMode === 'dashboard'" class="card">
      <h3>Dashboard</h3>
      <p>Total de usuários cadastrados: {{ totalUsuarios }}</p>
      <div class="chart-container">
        <canvas baseChart
          [data]="barChartData"
          [options]="barChartOptions"
          [type]="barChartType">
        </canvas>
      </div>
    </div>

    <!-- Seção de Aprovação de Usuários -->
    <div *ngIf="viewMode === 'usuarios'" class="card">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-2xl font-bold text-white">Gerenciar Usuários</h3>
        <button (click)="logout()" class="btn-logout-header">
          <img src="assets/icons/logout.svg" alt="Sair" class="menu-icon">
          Sair
        </button>
      </div>
      <div class="filtros">
        <div class="form-group">
          <label for="filtroStatus">Filtrar por Status:</label>
          <select id="filtroStatus" [(ngModel)]="filtroStatus" (change)="aplicarFiltros()">
            <option value="TODOS">Todos</option>
            <option value="PENDENTE">Pendente</option>
            <option value="ATIVO">Ativo</option>
            <option value="RECUSADO">Recusado</option>
          </select>
        </div>
        <div class="form-group">
          <label for="filtroNomeUsername">Filtrar por Nome/Username:</label>
          <input type="text" id="filtroNomeUsername" [(ngModel)]="filtroNomeUsername" (input)="aplicarFiltros()" placeholder="Digite nome ou Username" />
        </div>
      </div>
      <div class="export-buttons">
        <button (click)="exportarUsuariosParaPdf()" class="btn-export-pdf mr-2" title="Exportar para PDF">
          <i class="fas fa-file-pdf"></i>
        </button>
        <button (click)="exportarUsuariosParaExcel()" class="btn-export-excel" title="Exportar para Excel">
          <i class="fas fa-file-excel"></i>
        </button>
      </div>

      <div class="tabela-container">
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>CPF</th>
              <th>E-mail</th>
              <th>Telefone</th>
              <th>Status</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let usuario of usuariosFiltrados">
              <td>{{ usuario.nome }}</td>
              <td>{{ usuario.cpf }}</td>
              <td>{{ usuario.email }}</td>
              <td>{{ usuario.telefone }}</td>
              <td>
                <span [ngClass]="getStatusClass(usuario.status)">
                  {{ usuario.status }}
                </span>
              </td>
              <td class="acoes">
                <button *ngIf="usuario.status === 'PENDENTE'" (click)="aprovarCadastro(usuario.id)" class="btn-aprovar">Aprovar</button>
                <button *ngIf="usuario.status === 'PENDENTE'" (click)="reprovarCadastro(usuario.id)" class="btn-reprovar">Reprovar</button>
              </td>
            </tr>
            <ng-container *ngIf="usuariosFiltrados.length === 0">
              <tr>
                <td colspan="6" class="no-results">Nenhum usuário encontrado</td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Seção de Aprovação de Empréstimos -->
    <div *ngIf="viewMode === 'emprestimos'" class="card">
      <h3>Gerenciar Empréstimos</h3>
      <div class="filtros">
        <div class="form-group">
          <label for="filtroStatusEmprestimo">Filtrar por Status:</label>
          <select id="filtroStatusEmprestimo" [(ngModel)]="filtroStatusEmprestimo" (change)="aplicarFiltrosEmprestimos()">
            <option value="PENDENTE">Pendentes</option>
            <option value="APROVADO">Aprovados</option>
            <option value="NEGADO">Negados</option>
            <option value="TODOS">Todos</option>
          </select>
        </div>
      </div>
      <div class="export-buttons">
        <button (click)="exportarEmprestimosParaPdf()" class="btn-export-pdf">Exportar para PDF</button>
        <button (click)="exportarEmprestimosParaExcel()" class="btn-export-excel">Exportar para Excel</button>
      </div>
      <div class="tabela-container">
        <table>
          <thead>
            <tr>
              <th>ID Empréstimo</th>
              <th>CPF Usuário</th>
              <th>Valor</th>
              <th>Status</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let emprestimo of emprestimosFiltrados">
              <td>{{emprestimo.id}}</td>
              <td>{{emprestimo.usuario.cpf}}</td>
              <td>{{emprestimo.valor | currency:'BRL'}}</td>
              <td>
                <span [ngClass]="getEmprestimoStatusClass(emprestimo.status)">
                  {{ getEmprestimoStatus(emprestimo.status) }}
                </span>
              </td>
              <td class="acoes">
                <button *ngIf="emprestimo.status === 'PENDENTE'" (click)="aprovarEmprestimo(emprestimo.id)" class="btn-aprovar">Aprovar</button>
                <button *ngIf="emprestimo.status === 'PENDENTE'" (click)="reprovarEmprestimo(emprestimo.id)" class="btn-reprovar">Reprovar</button>
              </td>
            </tr>
            <tr *ngIf="emprestimosFiltrados.length === 0">
              <td colspan="5" class="no-results">Nenhum empréstimo encontrado com o status selecionado.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Seção de Configurações -->
    <div *ngIf="viewMode === 'configuracoes'" class="card">
      <h3>Configurações do Gerente</h3>
      <p>Aqui você pode gerenciar as configurações da sua conta.</p>
      <!-- Formulário para trocar senha -->
      <div class="form-group">
        <label for="novaSenha">Nova Senha:</label>
        <input type="password" id="novaSenha" [(ngModel)]="novaSenha" placeholder="Digite a nova senha" />
      </div>
      <div class="form-group">
        <label for="confirmarSenha">Confirmar Senha:</label>
        <input type="password" id="confirmarSenha" [(ngModel)]="confirmarSenha" placeholder="Confirme a nova senha" />
      </div>
      <button (click)="trocarSenha()" class="btn-aprovar">Trocar Senha</button>
    </div>
  </div>
</div>
